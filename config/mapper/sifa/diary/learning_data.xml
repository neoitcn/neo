<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aofa.sifa.mapper.diary.LearnDataDao">
	<sql id="learnDataColumns">
		d.id
	</sql>
	<sql id="learnDataColumns2">
		id
	</sql>
	<sql id="fileColumns">
		f.id as file_id,
		f.file_name,
		f.file_type,
		f.length,
		f.file_path,
		f.object_id,
		f.creater_id,
		f.create_time,
		f.update_id,
		f.update_time,
		f.deleted
	</sql>
	<resultMap type="LearnData" id="learnDataMap">
		<id column="id" property="id"></id>
		<association property="sysFile" column="id" javaType="SysFile">
			<id column="file_id" property="id" />
			<result column="file_name" property="fileName" />
			<result column="file_type" property="fileType" />
			<result column="length" property="fileLength" />
			<result column="file_path" property="filePath" />
			<result column="object_id" property="objectId" />
			<result column="creater_id" property="createrId" />
			<result column="create_time" property="createTime" />
			<result column="update_id" property="updateId" />
			<result column="update_time" property="updateTime" />
			<result property="deleted" column="deleted" />
			<result property="enabled" column="enabled" />
		</association>
	</resultMap>

	<select id="getCount" resultType="java.lang.Long">
		select count(*) from dm_learning_data d
		<if test="name != null and name!=''">
			left join sys_file f on f.object_id = d.id where f.file_name like concat('%',#{name},'%')
		</if>
	</select>
	<select id="getLearnDatas" resultMap="learnDataMap">
		select
		<include refid="learnDataColumns" />,
		<include refid="fileColumns" />
		from dm_learning_data d
		left join sys_file f on f.object_id = d.id 
		<if test="name != null and name!=''">
			where f.file_name like concat('%',#{name},'%')
		</if>
		order by f.create_time desc
		<if test="rows > 0">
			limit #{start},#{rows}
		</if>
	</select>
	<insert id="addLearnData">
		insert into dm_learning_data(
		<include refid="learnDataColumns2" />
		)values(
			#{id}
		)
	</insert>
	<delete id="deleteLearnData">
		delete from dm_learning_data where id = #{id}
	</delete>
</mapper>