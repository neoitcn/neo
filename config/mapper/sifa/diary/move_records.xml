<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aofa.sifa.mapper.diary.MoveRecordsDao">
	<sql id="moveRecordsColumns">
		mr.id,
		mr.name,
		mr.move_addr,
		mr.move_reason,
		mr.family_name,
		mr.home_addr,
		mr.corr_company,
		mr.move_time,
		mr.work_info,
		mr.relationship,
		mr.remarks,
		mr.phone,
		mr.political_status,
		mr.work_company,
		mr.creater_id,
		mr.create_time,
		mr.update_id,
		mr.update_time,
		mr.deleted
	</sql>
	<sql id="moveRecordsColumns2">
		id,
		name,
		move_addr,
		move_reason,
		family_name,
		home_addr,
		corr_company,
		move_time,
		work_info,
		relationship,
		remarks,
		phone,
		political_status,
		work_company,
		creater_id,
		create_time,
		update_id,
		update_time,
		deleted
	</sql>
	<resultMap type="MoveRecords" id="moveRecordsMap" extends="baseBean">
		<id column="id" property="id"></id>
		<result column="name" property="name"/>
		<result column="move_addr" property="moveAddr"/>
		<result column="move_reason" property="moveReason"/>
		<result column="family_name" property="familyName"/>
		<result column="home_addr" property="homeAddr"/>
		<result column="corr_company" property="corrCompany"/>
		<result column="move_time" property="moveTime"/>
		<result column="work_info" property="workInfo"/>
		<result column="relationship" property="relationship"/>
		<result column="remarks" property="remarks"/>
		<result column="phone" property="phone"/>
		<result column="political_status" property="politicalStatus"/>
		<result column="work_company" property="workCompany"/>
	</resultMap>
	<resultMap type="BaseBean" id="baseBean">
		<result column="creater_id" property="createrId"/>
		<result column="create_time" property="createTime"/>
		<result column="update_id" property="updateId"/>
		<result column="update_time" property="updateTime"/>
		<result property="deleted" column="deleted" />
		<result property="enabled" column="enabled" />
	</resultMap>
    
    <select id="getCount" resultType="java.lang.Long">
    	select count(id) from dm_move_records mr where mr.deleted=1
    	<if test="name != null and name!=''">
			and mr.name like concat('%',#{name},'%')
		</if>
		<if test="moveTime !=null">
			and mr.move_time >= #{moveTime}
		</if>
    </select>
    
    <select id="getMoveRecords" resultMap="moveRecordsMap">
    	select 
			<include refid="moveRecordsColumns" />
		from dm_move_records mr where mr.deleted=1
		<if test="name != null and name!=''">
			and mr.name like concat('%',#{name},'%')
		</if>
		<if test="moveTime !=null">
			and mr.move_time >= #{moveTime}
		</if>
		<if test="rows > 0">
			limit #{start},#{rows}
		</if>
    </select>
    <select id="getMoveRecordById" resultMap="moveRecordsMap">
    	select 
			<include refid="moveRecordsColumns" />
		from dm_move_records mr where mr.deleted=1 and mr.id=#{id}
	</select>
	<insert id="addMoveRecord">
		insert into dm_move_records(
			<include refid="moveRecordsColumns2" />
		)values(
			#{id},
			#{name},
			#{moveAddr},
			#{moveReason},
			#{familyName},
			#{homeAddr},
			#{corrCompany},
			#{moveTime},
			#{workInfo},
			#{relationship},
			#{remarks},
			#{phone},
			#{politicalStatus},
			#{workCompany},
			#{createrId},
			#{createTime},
			#{updateId},
			#{updateTime},
			#{deleted}
		)
	</insert>
    <update id="updateMoveRecord">
		update dm_move_records set
			name=#{name},
			move_addr=#{moveAddr},
			move_reason=#{moveReason},
			family_name=#{familyName},
			home_addr=#{homeAddr},
			corr_company=#{corrCompany},
			move_time=#{moveTime},
			work_info=#{workInfo},
			relationship=#{relationship},
			remarks=#{remarks},
			phone=#{phone},
			political_status=#{politicalStatus},
			work_company=#{workCompany},
			update_id=#{updateId},
			update_time=#{updateTime},
			deleted=#{deleted}
		where id=#{id}
	</update>
	<update id="deleteMoveRecord">
		update dm_move_records set deleted=0 where id=#{id}
	</update>
</mapper>